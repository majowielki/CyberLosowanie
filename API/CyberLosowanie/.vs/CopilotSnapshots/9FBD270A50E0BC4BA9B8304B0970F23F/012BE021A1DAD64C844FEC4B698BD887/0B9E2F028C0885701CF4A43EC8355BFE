using CyberLosowanie.Models;
using Microsoft.AspNetCore.Identity.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Storage.ValueConversion;
using System.Text.Json;

namespace CyberLosowanie.Data
{
    public class ApplicationDbContext : IdentityDbContext<ApplicationUser>
    {
        public ApplicationDbContext(DbContextOptions options) : base(options)
        {
            
        }

        public DbSet<ApplicationUser> ApplicationUsers { get; set; }
        public DbSet<Cyberek> Cyberki { get; set; }

        protected override void OnModelCreating(ModelBuilder modelBuilder)
        {
            base.OnModelCreating(modelBuilder);

            // Value converter for List<int> BannedCyberki
            var bannedCyberkiConverter = new ValueConverter<List<int>, string>(
                v => JsonSerializer.Serialize(v, (JsonSerializerOptions)null),
                v => JsonSerializer.Deserialize<List<int>>(v, (JsonSerializerOptions)null) ?? new List<int>()
            );
            modelBuilder.Entity<Cyberek>()
                .Property(c => c.BannedCyberki)
                .HasConversion(bannedCyberkiConverter);

            modelBuilder.Entity<Cyberek>().HasData(
                new Cyberek
                {
                    Id = 1,
                    Name = "Michał",
                    Surname = "Majewski",
                    ImageUrl = "https://randomuser.me/api/portraits/men/1.jpg",
                    BannedCyberki = new List<int> { 1, 2, 6 }
                },
                new Cyberek
                {
                    Id = 2,
                    Name = "Kornelia",
                    Surname = "Majewska",
                    ImageUrl = "https://randomuser.me/api/portraits/women/2.jpg",
                    BannedCyberki = new List<int> { 1, 2, 10 }
                },
                new Cyberek
                {
                    Id = 3,
                    Name = "Ola",
                    Surname = "Sudoł",
                    ImageUrl = "https://randomuser.me/api/portraits/women/3.jpg",
                    BannedCyberki = new List<int> { 3, 9, 11 }
                },
                new Cyberek
                {
                    Id = 4,
                    Name = "Daria",
                    Surname = "Kurowska",
                    ImageUrl = "https://randomuser.me/api/portraits/women/4.jpg",
                    BannedCyberki = new List<int> { 2, 4, 11 }
                },
                new Cyberek
                {
                    Id = 5,
                    Name = "Asia",
                    Surname = "Małek",
                    ImageUrl = "https://randomuser.me/api/portraits/women/5.jpg",
                    BannedCyberki = new List<int> { 5, 7, 8 }
                },
                new Cyberek
                {
                    Id = 6,
                    Name = "Filip",
                    Surname = "Wilczyński",
                    ImageUrl = "https://randomuser.me/api/portraits/men/6.jpg",
                    BannedCyberki = new List<int> { 5, 6, 12 }
                },
                new Cyberek
                {
                    Id = 7,
                    Name = "Marek",
                    Surname = "Grabowski",
                    ImageUrl = "https://randomuser.me/api/portraits/men/7.jpg",
                    BannedCyberki = new List<int> { 3, 7, 10 }
                },
                new Cyberek
                {
                    Id = 8,
                    Name = "Michał",
                    Surname = "Karbowiak",
                    ImageUrl = "https://randomuser.me/api/portraits/men/8.jpg",
                    BannedCyberki = new List<int> { 1, 5, 8 }
                },
                new Cyberek
                {
                    Id = 9,
                    Name = "Karol",
                    Surname = "Jagiełło",
                    ImageUrl = "https://randomuser.me/api/portraits/men/9.jpg",
                    BannedCyberki = new List<int> { 3, 4, 9 }
                },
                new Cyberek
                {
                    Id = 10,
                    Name = "Natalia",
                    Surname = "Dutka",
                    ImageUrl = "https://randomuser.me/api/portraits/women/10.jpg",
                    BannedCyberki = new List<int> { 7, 10, 12 }
                },
                new Cyberek
                {
                    Id = 11,
                    Name = "Paweł",
                    Surname = "Kurowski",
                    ImageUrl = "https://randomuser.me/api/portraits/men/11.jpg",
                    BannedCyberki = new List<int> { 4, 8, 11 }
                },
                new Cyberek
                {
                    Id = 12,
                    Name = "Wiktoria",
                    Surname = "Wilczyńska",
                    ImageUrl = "https://randomuser.me/api/portraits/women/12.jpg",
                    BannedCyberki = new List<int> { 6, 9, 12 }
                });
        }
    }
}
